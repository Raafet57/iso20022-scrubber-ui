<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Storyteller – ISO 20022 Narrative Generator</title>
    <style>
      :root {
        color: #e5e7eb;
        background-color: #0b1220;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        line-height: 1.5;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: #0b1220;
        color: #e5e7eb;
      }
      .page {
        max-width: 1150px;
        margin: 0 auto;
        padding: 40px 18px 64px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      .headline {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .kicker {
        text-transform: uppercase;
        letter-spacing: 0.16em;
        font-size: 12px;
        color: #94a3b8;
      }
      h1 {
        margin: 0;
        font-size: 30px;
        font-weight: 700;
      }
      .lede {
        max-width: 720px;
        color: #9ca3af;
        margin: 0;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        gap: 18px;
      }
      .card {
        background: linear-gradient(145deg, rgba(17, 24, 39, 0.95), rgba(12, 20, 34, 0.95));
        border: 1px solid #1f2937;
        border-radius: 18px;
        box-shadow: 0 24px 70px rgba(0, 0, 0, 0.35);
        padding: 20px;
      }
      .card h2 {
        margin: 0 0 6px 0;
        font-size: 18px;
      }
      .card p.label {
        margin: 0;
        color: #94a3b8;
        font-size: 14px;
      }
      textarea {
        width: 100%;
        height: 280px;
        resize: none;
        background: #0f172a;
        color: #e2e8f0;
        border: 1px solid #1f2937;
        border-radius: 14px;
        font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, monospace;
        font-size: 13px;
        line-height: 1.3;
        padding: 12px;
        transition: border 150ms ease, box-shadow 150ms ease;
      }
      textarea:focus,
      select:focus,
      input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      select,
      input[type='file'] {
        width: 100%;
        padding: 10px 12px;
        background: #0f172a;
        color: #e5e7eb;
        border: 1px solid #1f2937;
        border-radius: 12px;
        font-size: 14px;
      }
      .controls {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 12px;
      }
      .btn-primary {
        width: 100%;
        background: linear-gradient(135deg, #3f6bff, #5b8aff);
        color: #fff;
        border: none;
        border-radius: 14px;
        padding: 14px;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 150ms ease, box-shadow 150ms ease;
        box-shadow: 0 20px 60px rgba(63, 107, 255, 0.35);
      }
      .btn-primary:hover {
        transform: translateY(-2px) scale(1.01);
        box-shadow: 0 28px 70px rgba(63, 107, 255, 0.45);
      }
      .btn-secondary {
        background: #1f2937;
        color: #e5e7eb;
        border: 1px solid #273449;
        border-radius: 12px;
        padding: 10px 14px;
        cursor: pointer;
        transition: background 150ms ease, transform 150ms ease;
      }
      .btn-secondary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .btn-secondary:not(:disabled):hover {
        background: #273449;
        transform: translateY(-1px);
      }
      .tabs {
        display: flex;
        gap: 8px;
      }
      .tab-button {
        background: #1f2937;
        color: #e5e7eb;
        border: 1px solid #273449;
        border-radius: 12px;
        padding: 10px 12px;
        cursor: pointer;
        transition: background 150ms ease, transform 150ms ease;
      }
      .tab-button.active {
        background: #3f6bff;
        border-color: #3f6bff;
        box-shadow: 0 12px 30px rgba(63, 107, 255, 0.3);
      }
      .tab-button:hover {
        transform: translateY(-1px);
      }
      .loader {
        margin: 16px auto;
        border: 4px solid #1f2937;
        border-top: 4px solid #3f6bff;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .hidden { display: none; }
      .stack { display: flex; flex-direction: column; gap: 12px; }
      .output-box {
        min-height: 220px;
        background: #0f172a;
        border: 1px solid #1f2937;
        border-radius: 14px;
        padding: 14px;
        color: #e5e7eb;
      }
      pre.code {
        background: #0f172a;
        border: 1px solid #1f2937;
        border-radius: 14px;
        padding: 12px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 13px;
        line-height: 1.3;
        max-height: 320px;
        overflow: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th, td {
        padding: 10px 6px;
        text-align: left;
      }
      th { color: #9ca3af; font-weight: 600; }
      tr + tr td, tr + tr th { border-top: 1px solid #1f2937; }
      .actions { display: flex; gap: 10px; flex-wrap: wrap; }
    </style>
  </head>
  <body>
    <div class="page">
      <header class="headline">
        <div class="kicker">ISO 20022 Micro-tools</div>
        <h1>Storyteller – Narrative Generator</h1>
        <p class="lede">
          Paste or upload ISO 20022 XML (pacs.008/009/002/004, camt.052/053/054), then generate paragraph and concise summaries for analysts.
          All parsing happens in your browser.
        </p>
      </header>

      <section class="grid">
        <div class="card stack">
          <div>
            <h2>Input message XML</h2>
            <p class="label">Paste, upload, or load a sample.</p>
          </div>

          <textarea id="xmlInput" placeholder="Paste ISO 20022 XML here..."></textarea>

          <div class="stack">
            <label class="label" style="color: #94a3b8; font-weight: 600">Load sample:</label>
            <select id="sampleSelect">
              <option value="">Select sample...</option>
              <option value="./samples/pacs008-sample.xml">pacs.008 – sample</option>
              <option value="./samples/pacs009-sample.xml">pacs.009 – sample</option>
              <option value="./samples/camt053-sample.xml">camt.053 – sample</option>
              <option value="./samples/bulk-pacs008-asia-urgent.xml">pacs.008 – Asia urgent</option>
              <option value="./samples/bulk-pacs008-eur-cover.xml">pacs.008 – EUR cover</option>
              <option value="./samples/bulk-pacs008-fx-multicurrency.xml">pacs.008 – FX multicurrency</option>
              <option value="./samples/bulk-pacs008-gbp-priority.xml">pacs.008 – GBP priority</option>
              <option value="./samples/bulk-pacs008-highcharges.xml">pacs.008 – High charges</option>
              <option value="./samples/bulk-pacs008-latam-trade.xml">pacs.008 – LATAM trade</option>
              <option value="./samples/bulk-pacs008-missing-remittance.xml">pacs.008 – Missing remittance</option>
              <option value="./samples/bulk-pacs008-sme-payroll.xml">pacs.008 – SME payroll</option>
              <option value="./samples/bulk-pacs008-structured-remittance.xml">pacs.008 – Structured remittance</option>
              <option value="./samples/bulk-pacs008-uat-test.xml">pacs.008 – UAT test</option>
              <option value="./samples/bulk-pacs008-weekend.xml">pacs.008 – Weekend</option>
              <option value="./samples/bulk-pacs009-africa-hvl.xml">pacs.009 – Africa HVL</option>
              <option value="./samples/bulk-pacs009-asia-multi-hop.xml">pacs.009 – Asia multi-hop</option>
              <option value="./samples/bulk-pacs009-cover-chf.xml">pacs.009 – CHF cover</option>
              <option value="./samples/bulk-pacs009-latam-eur.xml">pacs.009 – LATAM EUR</option>
              <option value="./samples/bulk-pacs009-serial-usd.xml">pacs.009 – Serial USD</option>
              <option value="./samples/bulk-pacs009-weekend.xml">pacs.009 – Weekend</option>
              <option value="./samples/bulk-pacs002-reject.md07.xml">pacs.002 – Reject MD07</option>
              <option value="./samples/bulk-pacs004-return.xml">pacs.004 – Return</option>
              <option value="./samples/bulk-camt052-intraday.xml">camt.052 – Intraday</option>
              <option value="./samples/bulk-camt053-asia-multi-entry.xml">camt.053 – Asia multi-entry</option>
              <option value="./samples/bulk-camt053-eur-weekend.xml">camt.053 – EUR weekend</option>
              <option value="./samples/bulk-camt053-latam.xml">camt.053 – LATAM</option>
              <option value="./samples/bulk-camt053-uat.xml">camt.053 – UAT</option>
              <option value="./samples/bulk-camt053-us-multicurrency.xml">camt.053 – US multicurrency</option>
              <option value="./samples/bulk-camt054-credit.xml">camt.054 – Credit advice</option>
            </select>

            <input id="fileInput" type="file" accept=".xml,text/xml" />

            <button class="btn-primary" id="summarizeButton">Generate narratives</button>
            <div id="inputError" class="hidden" style="background:#3f1d29;border:1px solid #7f1d1d;color:#fecdd3;padding:10px 12px;border-radius:10px;font-size:13px;"></div>
          </div>
        </div>

        <div class="card stack">
          <div class="actions" style="justify-content: space-between; align-items: flex-start;">
            <div>
              <h2>Results</h2>
              <p class="label">Narrative, concise summary, JSON, and key fields.</p>
            </div>
            <div class="actions">
              <button class="btn-secondary" id="copyNarrative" disabled>Copy narrative</button>
              <button class="btn-secondary" id="copyConcise" disabled>Copy concise</button>
            </div>
          </div>

          <div id="loader" class="loader hidden"></div>
          <div id="resultsEmpty" class="label">Run the generator to see results.</div>

          <div id="resultsContainer" class="hidden stack">
            <div class="tabs">
              <button class="tab-button active" data-tab="narrative">Narrative</button>
              <button class="tab-button" data-tab="concise">Concise</button>
              <button class="tab-button" data-tab="json">JSON</button>
              <button class="tab-button" data-tab="summary">Summary</button>
            </div>

            <div id="tab-narrative">
              <div id="narrativeOutput" class="output-box"></div>
            </div>

            <div id="tab-concise" class="hidden">
              <div id="conciseOutput" class="output-box"></div>
            </div>

            <div id="tab-json" class="hidden">
              <pre id="jsonOutput" class="code"></pre>
            </div>

            <div id="tab-summary" class="hidden">
              <table>
                <tbody id="summaryTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script>
      const textarea = document.getElementById('xmlInput');
      const sampleSelect = document.getElementById('sampleSelect');
      const fileInput = document.getElementById('fileInput');
      const button = document.getElementById('summarizeButton');
      const loader = document.getElementById('loader');
      const resultsContainer = document.getElementById('resultsContainer');
      const resultsEmpty = document.getElementById('resultsEmpty');
      const narrativeOutput = document.getElementById('narrativeOutput');
      const conciseOutput = document.getElementById('conciseOutput');
      const jsonOutput = document.getElementById('jsonOutput');
      const summaryTable = document.getElementById('summaryTable');
      const inputError = document.getElementById('inputError');
      const copyNarrative = document.getElementById('copyNarrative');
      const copyConcise = document.getElementById('copyConcise');

      document.querySelectorAll('.tab-button').forEach((tab) => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab-button').forEach((btn) => btn.classList.remove('active'));
          tab.classList.add('active');
          ['narrative', 'concise', 'json', 'summary'].forEach((key) =>
            document.getElementById(`tab-${key}`).classList.add('hidden'),
          );
          document.getElementById(`tab-${tab.dataset.tab}`).classList.remove('hidden');
        });
      });

      sampleSelect.addEventListener('change', async (event) => {
        const path = event.target.value;
        if (!path) return;
        try {
          loader.classList.remove('hidden');
          const response = await fetch(path);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const text = await response.text();
          textarea.value = text;
          inputError.classList.add('hidden');
        } catch (err) {
          inputError.textContent = 'Unable to load sample file.';
          inputError.classList.remove('hidden');
        } finally {
          loader.classList.add('hidden');
        }
      });

      fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          textarea.value = reader.result;
          inputError.classList.add('hidden');
        };
        reader.readAsText(file);
      });

      button.addEventListener('click', async () => {
        const xml = textarea.value.trim();
        if (!xml) {
          inputError.textContent = 'Please paste or upload XML to summarize.';
          inputError.classList.remove('hidden');
          return;
        }
        inputError.classList.add('hidden');
        loader.classList.remove('hidden');
        resultsContainer.classList.add('hidden');
        resultsEmpty.classList.add('hidden');
        copyNarrative.disabled = true;
        copyConcise.disabled = true;

        try {
          const payload = await parseXml(xml);
          const narrative = buildNarrative(payload);
          const concise = buildConcise(payload);
          renderResults(payload, narrative, concise);
        } catch (err) {
          console.error(err);
          inputError.textContent = err.message || 'Failed to parse XML';
          inputError.classList.remove('hidden');
        } finally {
          loader.classList.add('hidden');
        }
      });

      copyNarrative.addEventListener('click', async () => {
        if (!narrativeOutput.textContent) return;
        await navigator.clipboard.writeText(narrativeOutput.textContent);
        copyNarrative.textContent = 'Copied!';
        setTimeout(() => (copyNarrative.textContent = 'Copy narrative'), 1200);
      });

      copyConcise.addEventListener('click', async () => {
        if (!conciseOutput.textContent) return;
        await navigator.clipboard.writeText(conciseOutput.textContent);
        copyConcise.textContent = 'Copied!';
        setTimeout(() => (copyConcise.textContent = 'Copy concise'), 1200);
      });

      function parseXml(xml) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, 'text/xml');
        const parsererror = doc.getElementsByTagName('parsererror');
        if (parsererror.length) throw new Error('Invalid XML. Please check formatting.');

        const messageType = detectType(doc);
        if (messageType === 'unknown') throw new Error('Unsupported or unrecognised ISO 20022 message type.');
        if (messageType === 'camt.052' || messageType === 'camt.053' || messageType === 'camt.054') {
          return parseStatement(doc, messageType);
        }
        return parsePayment(doc, messageType);
      }

      function textContent(node, selector) {
        const el = node.querySelector(selector);
        return el ? (el.textContent || '').trim() : '';
      }

      function detectType(doc) {
        const rootChild = doc.documentElement.firstElementChild;
        const tag = (rootChild && rootChild.localName) || '';
        if (tag === 'FIToFICstmrCdtTrf') return 'pacs.008';
        if (tag === 'FICdtTrf') return 'pacs.009';
        if (tag === 'FIToFIPmtStsRpt') return 'pacs.002';
        if (tag === 'PmtRtr') return 'pacs.004';
        if (tag === 'BkToCstmrStmt') return 'camt.053';
        if (tag === 'BkToCstmrAcctRpt') return 'camt.052';
        if (tag === 'BkToCstmrDbtCdtNtfctn') return 'camt.054';
        return 'unknown';
      }

      function parsePayment(doc, messageType) {
        const tx =
          messageType === 'pacs.002'
            ? doc.querySelector('TxInfAndSts')
            : messageType === 'pacs.004'
              ? doc.querySelector('RtrTxInf')
              : doc.querySelector('CdtTrfTxInf');
        if (!tx) throw new Error('Missing transaction information');
        const original = tx.querySelector('OrgnlTxRef');

        const payload = {
          message_type: messageType,
          actors: {},
          financial: {},
          references: {},
          remittance: {},
          charges: {},
        };

        const scope = original || tx;
        payload.actors.debtor = buildActor(scope, 'Dbtr');
        payload.actors.ultimate_debtor = buildActor(scope, 'UltmtDbtr');
        payload.actors.creditor = buildActor(scope, 'Cdtr');
        payload.actors.ultimate_creditor = buildActor(scope, 'UltmtCdtr');
        payload.actors.debtor_agent = buildActor(scope, 'DbtrAgt');
        payload.actors.creditor_agent = buildActor(scope, 'CdtrAgt');
        payload.actors.intermediary1 = buildActor(scope, 'IntrmyAgt1');
        payload.actors.intermediary2 = buildActor(scope, 'IntrmyAgt2');

        payload.financial.instructed_amount = {
          amount: textContent(scope, 'InstdAmt'),
          currency: scope.querySelector('InstdAmt')?.getAttribute('Ccy') || '',
        };
        payload.financial.settlement_amount = {
          amount: textContent(scope, 'IntrBkSttlmAmt') || textContent(tx, 'Amt'),
          currency:
            scope.querySelector('IntrBkSttlmAmt')?.getAttribute('Ccy') ||
            tx.querySelector('Amt')?.getAttribute('Ccy') ||
            '',
        };
        payload.financial.settlement_date = textContent(scope, 'IntrBkSttlmDt');
        if (messageType === 'pacs.002') {
          payload.status = textContent(tx, 'TxSts');
          payload.status_reason = textContent(tx, 'StsRsnInf Rsn Cd');
        }
        if (messageType === 'pacs.004') {
          payload.return_reason = textContent(tx, 'RtrRsnInf Rsn Cd');
        }

        payload.references = {
          end_to_end: textContent(scope, 'EndToEndId') || textContent(tx, 'OrgnlEndToEndId'),
          instruction: textContent(scope, 'InstrId'),
          transaction: textContent(scope, 'TxId'),
          uetr: textContent(scope, 'UETR'),
        };

        payload.remittance = {
          unstructured: Array.from(scope.querySelectorAll('RmtInf Ustrd')).map((n) => (n.textContent || '').trim()),
          structured: textContent(scope, 'Strd') || '',
        };

        payload.charges = {
          bearer: textContent(scope, 'ChrgBr'),
        };

        return payload;
      }

      function parseStatement(doc, messageType) {
        const container =
          messageType === 'camt.053'
            ? doc.querySelector('Stmt')
            : messageType === 'camt.052'
              ? doc.querySelector('Rpt')
              : doc.querySelector('Ntfctn');
        if (!container) throw new Error('Missing statement/notification node');

        const payload = {
          message_type: messageType,
          account: {},
          closing_balance: null,
          entries: [],
        };

        payload.account.iban = textContent(container, 'Acct IBAN');
        payload.account.owner = buildActor(container, 'Acct Ownr');

        payload.closing_balance = {
          amount: textContent(container, 'Bal Clsg BkTtlAmt'),
          currency: container.querySelector('Bal Clsg BkTtlAmt')?.getAttribute('Ccy') || '',
          date: textContent(container, 'Bal Clsg Dt'),
        };

        container.querySelectorAll('Ntry').forEach((entry) => {
          payload.entries.push({
            amount: textContent(entry, 'Amt'),
            currency: entry.querySelector('Amt')?.getAttribute('Ccy') || '',
            credit_debit: textContent(entry, 'CdtDbtInd'),
            booking_date: textContent(entry, 'BookgDt'),
            reference: textContent(entry, 'AcctSvcrRef') || textContent(entry, 'NtryRef'),
            remittance: textContent(entry, 'Ustrd'),
          });
        });

        return payload;
      }

      function buildActor(doc, tag) {
        const el = doc.querySelector(tag);
        if (!el) return null;
        const name = textContent(el, 'Nm');
        const account = textContent(el, 'IBAN') || textContent(el, 'Acct Id IBAN');
        const bic = textContent(el, 'BICFI') || textContent(el, 'FinInstnId BICFI');
        const country = textContent(el, 'Ctry') || textContent(el, 'PstlAdr Ctry');
        return { name, account, bic, country };
      }

      function actorName(actor) {
        if (!actor) return 'n/a';
        return actor.name || actor.account || actor.bic || 'n/a';
      }

      function formatAmount(obj) {
        if (!obj) return 'n/a';
        if (obj.amount && obj.currency) return `${obj.amount} ${obj.currency}`;
        return obj.amount || 'n/a';
      }

      function buildNarrative(payload) {
        if (payload.message_type.startsWith('camt.05')) return buildCamtNarrative(payload);
        const payer = actorName(payload.actors.debtor || payload.actors.debtor_agent);
        const beneficiary = actorName(payload.actors.creditor);
        const amount = formatAmount(payload.financial.settlement_amount || payload.financial.instructed_amount);
        const ref = payload.references.end_to_end || payload.references.instruction || payload.references.transaction || 'n/a';
        const uetr = payload.references.uetr || 'n/a';
        const rem = payload.remittance.unstructured || payload.remittance.structured || 'no remittance info provided';
        const bearer = payload.charges.bearer || 'n/a';
        const status = payload.status ? ` Status: ${payload.status}${payload.status_reason ? ` (${payload.status_reason})` : ''}.` : '';
        const reason = payload.return_reason ? ` Return reason: ${payload.return_reason}.` : '';
        return `${payload.message_type}: ${payer} pays ${beneficiary} ${amount}. Reference ${ref}, UETR ${uetr}. Charges borne by ${bearer}. Remittance: ${rem}.${status}${reason}`;
      }

      function buildConcise(payload) {
        if (payload.message_type.startsWith('camt.05')) return buildCamtConcise(payload);
        const payer = actorName(payload.actors.debtor || payload.actors.debtor_agent);
        const beneficiary = actorName(payload.actors.creditor);
        const amount = formatAmount(payload.financial.settlement_amount || payload.financial.instructed_amount);
        const bearer = payload.charges.bearer || 'n/a';
        const status = payload.status ? `; Status: ${payload.status}` : '';
        const reason = payload.status_reason || payload.return_reason ? `; Reason: ${payload.status_reason || payload.return_reason}` : '';
        return `Type: ${payload.message_type}; Payer: ${payer}; Beneficiary: ${beneficiary}; Amount: ${amount}; Charges: ${bearer}${status}${reason}`;
      }

      function buildCamtNarrative(payload) {
        const owner = actorName(payload.account.owner);
        const iban = payload.account.iban || 'n/a';
        const closing = payload.closing_balance;
        const amount = closing && closing.amount ? `${closing.amount} ${closing.currency || ''}` : 'n/a';
        const date = closing && closing.date ? closing.date : 'n/a';
        const entries = payload.entries || [];
        const samples = entries.slice(0, 3).map((entry) => {
          const entryAmount = entry.amount && entry.currency ? `${entry.amount} ${entry.currency}` : entry.amount || 'n/a';
          return `${entry.credit_debit} entry of ${entryAmount} on ${entry.booking_date} (ref ${entry.reference || 'n/a'})`;
        });
        const sampleText = samples.length ? samples.join('; ') : 'no booked entries described';
        return `Statement for ${owner} (${iban}) reports a closing balance of ${amount} on ${date}. The file lists ${entries.length} entries; examples include ${sampleText}.`;
      }

      function buildCamtConcise(payload) {
        const owner = actorName(payload.account.owner);
        const iban = payload.account.iban || 'n/a';
        const closing = payload.closing_balance;
        const amount = closing && closing.amount ? `${closing.amount} ${closing.currency || ''}` : 'n/a';
        return `Type: ${payload.message_type}; Account: ${iban}; Owner: ${owner}; Closing balance: ${amount}; Entries: ${payload.entries.length}`;
      }

      function renderResults(payload, narrative, concise) {
        narrativeOutput.textContent = narrative;
        conciseOutput.textContent = concise;
        jsonOutput.textContent = JSON.stringify(payload, null, 2);
        summaryTable.innerHTML = buildSummaryRows(payload);
        resultsContainer.classList.remove('hidden');
        resultsEmpty.classList.add('hidden');
        copyNarrative.disabled = false;
        copyConcise.disabled = false;
      }

      function buildSummaryRows(payload) {
        const rows = [];
        rows.push(`<tr><th>Message type</th><td>${payload.message_type}</td></tr>`);
        if (payload.message_type.startsWith('camt.05')) {
          rows.push(`<tr><th>Account</th><td>${payload.account && payload.account.iban}</td></tr>`);
          rows.push(`<tr><th>Owner</th><td>${actorName(payload.account && payload.account.owner)}</td></tr>`);
          rows.push(
            `<tr><th>Closing balance</th><td>${
              payload.closing_balance ? `${payload.closing_balance.amount} ${payload.closing_balance.currency || ''}` : 'n/a'
            }</td></tr>`,
          );
          rows.push(`<tr><th>Entries</th><td>${payload.entries.length}</td></tr>`);
        } else {
          const actors = payload.actors || {};
          rows.push(`<tr><th>Payer</th><td>${actorName(actors.debtor || actors.debtor_agent)}</td></tr>`);
          rows.push(`<tr><th>Beneficiary</th><td>${actorName(actors.creditor)}</td></tr>`);
          rows.push(`<tr><th>Amount</th><td>${formatAmount(payload.financial && payload.financial.settlement_amount)}</td></tr>`);
          const refs = payload.references || {};
          rows.push(`<tr><th>Instruction ID</th><td>${refs.instruction || 'n/a'}</td></tr>`);
          rows.push(`<tr><th>UETR</th><td>${refs.uetr || 'n/a'}</td></tr>`);
        }
        return rows.join('');
      }
    </script>
  </body>
</html>
